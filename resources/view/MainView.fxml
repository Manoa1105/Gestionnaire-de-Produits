<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<StackPane fx:id="rootPane" xmlns:fx="http://javafx.com/fxml"
           fx:controller="controller.MainController" styleClass="main-background">
    <BorderPane>

        <left>
            <VBox spacing="12" styleClass="sidebar">
                <Label text="Gestionnaire" style="-fx-text-fill: white; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                <Separator/>
                <Button text="Accueil" onAction="#afficherAccueil" styleClass="sidebar-button"/>
                <Button text="Produits" onAction="#afficherProduits" styleClass="sidebar-button"/>
            </VBox>
        </left>

        <center>
            <TabPane fx:id="tabPane">

                <!-- ================= Accueil ================= -->
                <Tab text="Accueil" closable="false">
                    <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED">
                        <content>
                            <VBox spacing="20">
                                <padding>
                                    <Insets top="20" right="20" bottom="20" left="20"/>
                                </padding>

                                <!-- KPI -->
                                <HBox spacing="16">
                                    <VBox spacing="6" styleClass="kpi-card">
                                        <Label text="Produits" styleClass="kpi-title"/>
                                        <Label fx:id="labelNbProduits" styleClass="kpi-value" text="0"/>
                                    </VBox>
                                    <VBox spacing="6" styleClass="kpi-card">
                                        <Label text="Valeur totale du stock" styleClass="kpi-title"/>
                                        <Label fx:id="labelValeurTotale" styleClass="kpi-value" text="0 Ar"/>
                                    </VBox>
                                    <VBox spacing="6" styleClass="kpi-card">
                                        <Label text="Catégorie la plus fréquente" styleClass="kpi-title"/>
                                        <Label fx:id="labelTopCategorie" styleClass="kpi-value" text="-"/>
                                    </VBox>
                                    <VBox spacing="6" styleClass="kpi-card">
                                        <Label text="Fournisseur principal" styleClass="kpi-title"/>
                                        <Label fx:id="labelTopFournisseur" styleClass="kpi-value" text="-"/>
                                    </VBox>
                                </HBox>

                                <!-- Alertes + Top fournisseurs -->
                                <HBox spacing="20">
                                    <VBox spacing="10" VBox.vgrow="ALWAYS">
                                        <Label text="Alertes stock bas" styleClass="kpi-title"/>
                                        <TableView fx:id="tableAlertes" prefHeight="320">
                                            <columns>
                                                <TableColumn fx:id="colAlerteNom" text="Produit" prefWidth="220"/>
                                                <TableColumn fx:id="colAlerteQuantite" text="Quantité" prefWidth="120"/>
                                            </columns>
                                        </TableView>
                                        <Label text="Astuce : double‑cliquez un élément pour l’ouvrir dans l’onglet Produits."
                                               styleClass="muted"/>
                                    </VBox>

                                    <VBox spacing="10" prefWidth="360">
                                        <Label text="Top fournisseurs (par quantités)" styleClass="kpi-title"/>
                                        <ListView fx:id="listTopFournisseurs" prefHeight="320"/>
                                    </VBox>
                                </HBox>
                            </VBox>
                        </content>
                    </ScrollPane>
                </Tab>

                <!-- ================= Produits ================= -->
                <Tab text="Produits" closable="false">
                    <BorderPane>
                        <padding>
                            <Insets top="16" right="16" bottom="16" left="16"/>
                        </padding>

                        <top>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <TextField fx:id="txtRecherche" promptText="Rechercher par nom ou fournisseur"/>
                                <ComboBox fx:id="comboFiltre" promptText="Filtrer par catégorie"/>
                                <Button text="Réinitialiser" onAction="#reinitialiserFiltres" styleClass="btn-secondary"/>
                                <Pane HBox.hgrow="ALWAYS"/>
                                <Label fx:id="labelValeurStock" styleClass="total-label" text="Valeur du stock : 0 Ar"/>
                            </HBox>
                        </top>

                        <center>
                            <StackPane>
                                <TableView fx:id="tableProduits" prefHeight="480">
                                    <columns>
                                        <TableColumn fx:id="colNom" text="Nom" prefWidth="180"/>
                                        <TableColumn fx:id="colCategorie" text="Catégorie" prefWidth="140"/>
                                        <TableColumn fx:id="colPrix" text="Prix (Ar)" prefWidth="120"/>
                                        <TableColumn fx:id="colQuantite" text="Quantité" prefWidth="100"/>
                                        <TableColumn fx:id="colFournisseur" text="Fournisseur" prefWidth="160"/>
                                    </columns>
                                </TableView>

                                <ScrollPane fx:id="scrollGrille" fitToWidth="true" visible="false">
                                    <content>
                                        <FlowPane fx:id="grilleProduits" hgap="16" vgap="16" prefWrapLength="900">
                                            <padding>
                                                <Insets top="10" right="10" bottom="10" left="10"/>
                                            </padding>
                                        </FlowPane>
                                    </content>
                                </ScrollPane>
                            </StackPane>
                        </center>

                        <bottom>
                            <HBox spacing="10" alignment="CENTER_RIGHT">
                                <padding>
                                    <Insets top="10" right="10" bottom="10" left="10"/>
                                </padding>
                                <Button text="Ajouter" onAction="#ajouterProduit" styleClass="btn-primary"/>
                                <Button text="Modifier" onAction="#modifierProduit" styleClass="btn-secondary"/>
                                <Button text="Supprimer" onAction="#supprimerProduit" styleClass="btn-danger"/>
                                <Pane HBox.hgrow="ALWAYS"/>
                                <Button fx:id="btnBasculeVue" text="Basculer en vue Grille"
                                        onAction="#basculerVue" styleClass="btn-secondary"/>
                            </HBox>
                        </bottom>
                    </BorderPane>
                </Tab>
            </TabPane>
        </center>
    </BorderPane>
</StackPane>
